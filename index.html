<!DOCTYPE html>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <html>
    <head>
        <title>Using web3 API with MetaMask</title>
        <input id='discordID' placeholder="Discord ID here"></input><button onclick="requestChallenge()">REQUEST CHALLENGE</button><br/>
        <input id='input' placeholder="Challenge"></input><button onclick="sign()">SIGN</button><br/>
        <div id='output'></div>
        <script src="https://cdn.jsdelivr.net/npm/web3@1.2.2/dist/web3.min.js"></script>
        <script>
            requestChallenge = function() {
              let v = document.getElementById('discordID')
              console.log(v.value)
              document.getElementById('output').innerHTML = 'http://localhost:8080/?discordID=' + v.value
            }
            
            sign = function() {
              let v = document.getElementById('input')   
              let d = document.getElementById('discordID')
              console.log(v.value)
              web3.eth.personal.sign(v.value, accountID[0], 'password', function(e,b) {
                console.log(e)
                console.log(b)
                output  = b + ' <br/> '
                output += 'http://localhost:8080/?challenge=' + v.value + '&response=' + b
                document.getElementById('output').innerHTML = output
              })
            }
            
            let accountID = '';
            window.addEventListener('load', function () {
                if (window.ethereum) {
                    window.web3 = new Web3(ethereum);
                    ethereum.enable()
                        .then(() => {
                            console.log("Ethereum enabled");
    
                            web3.eth.getAccounts(function (err, acc) {
                                if (err != null) {
                                    self.setStatus("There was an error fetching your accounts");
                                    return;
                                }
                                if (acc.length > 0) {
                                    accountID = acc;
                                    console.log(acc);
                                }
                            });
                        })
                        .catch(() => {
                            console.warn('User didn\'t allow access to accounts.');
                            waitLogin();
                        });
                } else {
                    console.log("Non-Ethereum browser detected. You should consider installing MetaMask.");
                }
            });
        </script>
    </head>
    </html>
